# A4_CHANGELOG (履歴管理)

## [2025-12-25] Run1: だるまUIパック（非破壊）
### 追加機能・変更点
- **JST日付判定の導入**: `getJSTNow()` を追加し、ブラウザの地域設定に関わらず日本時間で判定するように変更。
- **期間の更新**: 運用期間を 2025/12/26 〜 2026/01/07 (13日間) に固定。
- **だるまテーマ適用**: タイトルを「🎍 だるまの にこにこカレンダー」に変更。サブコピーをお正月仕様に切り替え。
- **スタンプ判子枠**: CSSにより😊🙂😢を円形の判子枠に変更し、選択時の沈み込みアニメーションを実装。
- **福バッジ**: 当日の2回完了を条件に「福」バッジを表示するロジックを追加。
- **導線A (おひっこし案内)**: 12/26以降の初回起動時に表示されるダイアログを実装。

## [2025-12-25] Run2: シーズンリセット（seasonId）
### 追加機能・変更点
- **自動シーズンリセット**: だるまシーズン開始日（12/26）以降の初回起動時に、進捗データを自動的に初期化するロジックを実装。
- **二重発火防止 (seasonId)**: `daruma_2025_12_26` を seasonId として導入。
  - 未ログイン時: localStorage (`santa_season_id`) に保存。
  - ログイン時: Supabase Auth の `user_metadata` に保存し、マルチデバイスでの整合性を確保。
- **リセット対象の限定**: スタンプ。おてつだい進捗のみを初期化し、音設定やテーマ設定、既読フラグなどは保持。

### 影響範囲
- `app.js` のデータロード・認証連携ロジック。
- 既存のログインユーザーの `progress` テーブル（初回1回のみリセットが走る）。

### 影響範囲
- UI表示、CSS、日付計算ロジック。
- 既存のDBデータ（Supabase/LocalStorage）への破壊的変更はなし。
